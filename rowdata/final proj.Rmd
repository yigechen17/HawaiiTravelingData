---
title: "FinalProject"
author: "Weijia Wang ww2589"
date: "2022/4/25"
output: html_document
---

笔记：
Q3 细分，哪些州收到covid影响较小

Q3 Pset4 facet grid年份-季节趋势图

Q1可以用表4中的first time visitor与否、age

length of stay在表3

```{r}
data1<- read.csv("1 visitor trend-不分state.csv")
data2<- read.csv("2 visitor trend-分state.csv")
data2.1<- read.csv("2.1 visitor trend- state plus dest.csv")
data3<- read.csv("3 destination.csv")
data4<- read.csv("4 Q2主要数据.csv")

library(tidyverse)
library(dplyr)
```

```{r}
d1<- tibble(data1[-c(7:10),][,-c(5:21)][,-c(3)][,c(1,2,3,8)])
d2<- tibble(data2[-c(301:304),][,-c(5:21)]) 
d2.1<- tibble(data2.1[-c(1051:1054),])[,-c(5:21)][,c(1,2,3,4,8)]
d3<- tibble(data3[-c(29:32),][,-c(5:29)][,c(1,2,3,4,9)])
d4<- tibble(data4[-c(217:220),][,-c(4:19)][,c(1, 2, 8)])
```



```{r}
d4.1<- d4 %>%
  filter(Group != "Visitor from US") %>%
  na.omit() %>%
  pivot_wider(names_from = Indicator, values_from = X2019) 
  
d4.1 %>%
  ggplot(aes(x = Group, y = `Avg. age of party head`)) +
  geom_col()

d4.1[,c(1,3,4)] %>%
  pivot_longer(c(`First timer (%)`, `Repeaters (%)`), 
               names_to ="Times of come", 
               values_to = "percentage") %>%
  ggplot(aes(x = Group, y = percentage, fill = `Times of come`)) +
  geom_col() 


purpose<- cbind(d4.1[,c(1)], d4.1[c(grep("Purpose",colnames(d4.1)))])%>%
  pivot_longer(c(2:16), 
               names_to ="Purpose", 
               values_to = "percentage") %>%
  mutate(Purpose = substr(Purpose, 9, 1000)) 
purpose %>%
  ggplot(aes(x = Group, y = percentage, fill = Purpose)) +
  geom_col()  +
  theme(axis.text.x = element_text(angle = 10, vjust = 0.5, hjust=1))


#a<- purpose %>%
#  filter(Group == "Oahu visitors") #%>%
#sum(a$percentage) - 81.8 - 4.6 -6.3 
#
#b<- Accom %>%
#  filter(Group == "Oahu visitors")
#sum(b$percentage)-10.1-5.3


Accom<- cbind(d4.1[,c(1)], d4.1[c(grep("Accom",colnames(d4.1)))]) %>%
  pivot_longer(c(2:14), 
               names_to ="Accomodation", 
               values_to = "percentage") %>%
  mutate(Accomodation = substr(Accomodation, 8, 1000)) 
Accom %>%
  ggplot(aes(x = Group, y = percentage, fill = Accomodation)) +
  geom_col() +
    theme(axis.text.x = element_text(angle = 10, vjust = 0.5, hjust=1))
```


```{r}  
library(treemap)
d3$X2019<- as.numeric(gsub(",","", d3$X2019))

d3 %>%
  filter(Indicator == "Visitor arrivals") %>%
  select( -c(Market, Units)) %>%
  treemap::treemap(index=c("Destination"),
                   vSize="X2019",
                   vColor="X2019",
                   type="value",
                   title="Number of visitors to different islands",  
                   format.legend = list(scientific = FALSE, big.mark = " ")) 
  
d3 %>%
  filter(Indicator == "Length of stay") %>%
  select( -c(Market, Units)) %>%
  treemap::treemap(index=c("Destination"),
                   vSize="X2019",
                   vColor="X2019",
                   type="value",
                   title="Length of stay for visitors to different islands",  
                   format.legend = list(scientific = FALSE, big.mark = " ")) 
```


```{r}
#devtools::install_github("timelyportfolio/parcoords")  
#install.packages("d3r")
library(parcoords)  
library(d3r)

g<- d2.1 %>%
  filter(Indicator == "Visitor arrivals") %>%
  dplyr::select(Destination, Market, X2019) %>%
  pivot_wider(names_from = Destination,
              values_from = X2019) 
g1 <- data.frame(t(data.frame(matrix(unlist(g), nrow=length(g), byrow=TRUE))))
colnames(g1)<- names(g)

library(GGally)
ggparcoord(g1, columns = 2:8, scale = "center", alphaLines = .7, splineFactor = 10, groupColumn = 1) +
 # geom_vline(xintercept = 2:7, color = "lightblue") +
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5))

interactive<- g1 %>%
  parcoords(  
    rownames = F     #   turn off rownames from the data.frame  
    , brushMode = "1D-axes"  
    , reorderable = T  
    , queue = T  
    , withD3 = TRUE     
  )
interactive

##为什么interactive出不来？？？
```















